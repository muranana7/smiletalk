<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ホーム画面 - 全画面表示</title>
<style>
:root {
  --main-color: #b79fcb;
  --main-color-dark: #a487c0;
  --secondary-bg: #faf7fc;
  --border-color: #d0c8da;
  --text-color: #333;
}

body {
  margin: 0;
  font-family: sans-serif;
  background: var(--secondary-bg);
  color: var(--text-color);
}

/* 全画面コンテナ */
.container {
  width: 100%;
  padding: 20px;
  box-sizing: border-box;
}

/* ヘッダー */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: var(--main-color);
  color: #fff;
  padding: 15px 20px;
}
.header-left {
  font-size: 1.5rem;
  font-weight: bold;
}
.header-right {
  display: flex;
  align-items: center;
  gap: 10px;
}
.new-create-button {
  background-color: #fff;
  color: var(--main-color);
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
}
.new-create-button:hover {
  background-color: #f0f0f0;
}

/* メインコンテンツ */
.main-content {
  display: flex;
  gap: 20px;
}

/* リスト・サイドバー共通 */
.main-list-area, .sidebar-area {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 3px 6px rgba(183, 159, 203, 0.1);
  padding: 20px;
}

/* 左右比率 */
.main-list-area { flex: 2; }
.sidebar-area { flex: 1; }

.list-header {
  display: flex;
  justify-content: space-between;
  font-weight: bold;
  font-size: 1.1rem;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 8px;
  margin-bottom: 12px;
}

.item-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.item-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  background: #faf7fc;
}
.item-list li:last-child { margin-bottom: 0; }

.item-name { font-size: 1rem; flex-grow: 1; }
.item-date { font-size: 0.9rem; color: #777; margin-left: 10px; }

.delete-btn {
  background: var(--main-color);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 4px 10px;
  cursor: pointer;
}
.delete-btn:hover { background: var(--main-color-dark); }

.sidebar-area h3 {
  text-align: center;
  color: var(--main-color);
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 1.2rem;
}

.item-list li.has-delete { justify-content: flex-start; }

/* フッター */
footer {
  margin-top: 30px;
  padding: 15px 20px;
  text-align: center;
  font-size: 0.9rem;
  color: #6b7280;
}
.logout-link, .board-link {
  color: var(--main-color);
  font-weight: bold;
  text-decoration: none;
  margin-right: 15px;
}
.logout-link:hover, .board-link:hover {
  color: var(--main-color-dark);
}

/* レスポンシブ */
@media (max-width: 768px) {
  .main-content { flex-direction: column; }
}


.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.modal {
  background: #fff;
  padding: 20px 24px;
  border-radius: 12px;
  width: 300px;
  text-align: center;
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.modal-text {
  margin-bottom: 20px;
  font-size: 1rem;
}

.modal-actions {
  display: flex;
  justify-content: space-between;
}

.modal-cancel {
  background: #ddd;
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.modal-delete {
  background: #d9534f;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  cursor: pointer;
}

.hidden {
  display: none;
}

</style>
</head>
<body>
<div class="container">
  <header>
    <div class="header-left">&lt; ホームページ &gt;</div>
    <div class="header-right">
      <button class="new-create-button" id="newPostButton">＋新規作成</button>
      
      <script>
        document.getElementById("newPostButton").addEventListener("click", function() {
          window.location.href = "/static_pages/new_post";
        });
      </script>

    </div>
  </header>

  <main class="main-content">
    <section class="main-list-area">
      <div class="list-header">
        <span class="list-title">タイトル名</span>
        <span class="list-date">日時</span>
      </div>
      <ul class="item-list">
        <% Post.order(created_at: :desc).each do |post| %>
          <li>
            <%= link_to static_pages_thread_view_path(id: post.id), class: "item-link" do %>
              <span class="item-name"><%= post.title %></span>
              <span class="item-date"><%= post.created_at.in_time_zone("Tokyo").strftime("%Y/%m/%d %H:%M") %></span>
            <% end %>
          </li>
        <% end %>
      </ul>


    </section>

    <aside class="sidebar-area">
      <h3>Myページ</h3>
      <div id="calendar"></div>
      <script>
      document.addEventListener("turbo:load", function () {
        const calendarEl = document.getElementById("calendar");
        if (!calendarEl) return;

        const countryCode = "JP";

        async function loadHolidays(year) {
          const response = await fetch(`https://date.nager.at/api/v3/PublicHolidays/${year}/${countryCode}`);
          const holidays = await response.json();

          return holidays.map(h => ({
            title: h.localName,
            start: h.date,
            allDay: true,
            display: "block",
            color: "#ff9f89"
          }));
        }

        const calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: "dayGridMonth",

          dayCellDidMount: function(info) {
            const today = new Date();
            const cellDate = info.date;

            // 今日を最優先で色付け
            if (
              cellDate.getFullYear() === today.getFullYear() &&
              cellDate.getMonth() === today.getMonth() &&
              cellDate.getDate() === today.getDate()
            ) {
              info.el.style.backgroundColor = "#fff3b0"; // 今日だけ黄色
              return; // ← 今日なら土日の色付けを上書きしない
            }

            // 土日色付け
            const day = cellDate.getDay(); // 0=日曜, 6=土曜
            if (day === 0) info.el.style.backgroundColor = "#ffe5e5"; // 日曜
            if (day === 6) info.el.style.backgroundColor = "#e5f0ff"; // 土曜
          },


          datesSet: async (info) => {
            const year = info.view.currentStart.getFullYear();
            const holidayEvents = await loadHolidays(year);

            calendar.removeAllEvents();
            calendar.addEventSource(holidayEvents);
          }
        });

        calendar.render();
        });
        document.addEventListener("turbo:load", function () {
          // カレンダーの初期化コード
        });
      </script>
      <div class="list-header"></div>
      <div class="list-header">
       <span class="list-title">タイトル名</span>
       <span class="list-date">日時</span>
      </div>
      <ul class="item-list">
        <% if logged_in? %>
          <% current_user.posts.order(created_at: :desc).each do |post| %>
            <li class="has-delete">
              <%= link_to static_pages_thread_view_path(id: post.id), class: "item-link" do %>
                <span class="item-name"><%= post.title %></span>
                <span class="item-date"><%= post.created_at.strftime("%Y/%m/%d") %></span>
              <% end %>
              <!-- 編集 -->
              <%= link_to "編集",
                edit_post_path(post),
                class: "delete-btn",
                style: "background:#6b9cff;" %>
                
              <%= button_to "削除",
                post_path(post),
                method: :delete,
                data: { turbo_confirm: "本当に削除しますか？" },
                class: "delete-btn" %>

            </li>
          <% end %>
        <% else %>
          <li>
            <span class="item-name">ログインしてください</span>
          </li>
        <% end %>
      </ul>

    </main>

  <footer>
    <a href="/static_pages/login" class="logout-link">ログアウト</a>
    <span>©</span>
    <a href="#" class="board-link">掲示板</a>
  </footer>
</div>

<div id="deleteModal" class="modal-overlay hidden">
  <div class="modal">
    <p>本当に削除しますか？</p>

    <div class="modal-actions">
      <button type="button" id="cancelDelete" class="modal-cancel">
        キャンセル
      </button>

      <%= form_with url: "", method: :delete, id: "deleteForm", data: { turbo: false } do %>
        <button type="submit" class="modal-delete">削除する</button>
      <% end %>
    </div>
  </div>
</div>


<script>
document.addEventListener("turbo:load", () => {
  const modal = document.getElementById("deleteModal");
  const cancelBtn = document.getElementById("cancelDelete");
  const form = document.getElementById("deleteForm");

  if (!modal) return;

  document.querySelectorAll(".js-delete").forEach(btn => {
    btn.addEventListener("click", e => {
      e.preventDefault();
      const postId = btn.dataset.postId;
      form.action = `/posts/${postId}`;
      modal.classList.remove("hidden");
    });
  });

  cancelBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
  });
});
</script>

</body>
</html>

